{* Hub Topic Page - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞ Hub –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è *}
{strip}
{* –ù–∞—Å–ª–µ–¥—É–µ–º –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–µ–º—ã Site waboot *}
{include file="`$wa_parent_theme_path`/index.html" inline}

{* JSON-LD Structured Data for Topic Page *}
{include file="schemas/social-media-posting-schema.html" post=$topic}

{* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ *}
{$wa->title($topic.title|escape)}
{$wa->globals("topicPage", $topic)}

{* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–æ–ø–∏–∫–∞ *}
<div class="hub-topic">
    {* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–æ–ø–∏–∫–∞ *}
    <div class="hub-topic__header">
        <h1 class="hub-topic__title">{$topic.title|escape}</h1>
        
        {* –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–æ–ø–∏–∫–∞ *}
        <div class="hub-topic__meta">
            <span class="hub-topic__author">
                {_w("Author")}: 
                <a href="{$wa->getUrl('hub/frontend/author')}/{$topic.contact_id}/" class="hub-topic__author-link">
                    {$topic.author.name|default:$topic.author.login|escape}
                </a>
            </span>
            <span class="hub-topic__date">
                {_w("Date")}: {$topic.datetime|wa_datetime:"humandatetime"}
            </span>
            {if !empty($topic.category)}
                <span class="hub-topic__category">
                    {_w("Category")}: 
                    <a href="{$topic.category.url}" class="hub-topic__category-link">
                        {$topic.category.name|escape}
                    </a>
                </span>
            {/if}
        </div>
        
        {* –¢–µ–≥–∏ —Ç–æ–ø–∏–∫–∞ *}
        {if !empty($topic.tags)}
            <div class="hub-topic__tags">
                {foreach $topic.tags as $tag}
                    <span class="hub-topic__tag">{$tag|escape}</span>
                {/foreach}
            </div>
        {/if}
    </div>
    
    {* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–ø–∏–∫–∞ *}
    <div class="hub-topic__content">
        {$topic.text}
    </div>
    
    {* –î–µ–π—Å—Ç–≤–∏—è —Å —Ç–æ–ø–∏–∫–æ–º *}
    <div class="hub-topic__actions">
        {if $wa->isAuth()}
            <button class="hub-topic__action hub-topic__action--like" data-topic-id="{$topic.id}">
                <span class="hub-topic__action-icon">üëç</span>
                <span class="hub-topic__action-text">{_w("Like")}</span>
                {if !empty($topic.likes_count)}
                    <span class="hub-topic__action-count">{$topic.likes_count}</span>
                {/if}
            </button>
            
            <button class="hub-topic__action hub-topic__action--share" data-topic-id="{$topic.id}">
                <span class="hub-topic__action-icon">üì§</span>
                <span class="hub-topic__action-text">{_w("Share")}</span>
            </button>
        {/if}
    </div>
    
    {* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–æ–ø–∏–∫—É *}
    <div class="hub-topic__comments">
        <h2 class="hub-topic__comments-title">{_w("Comments")}</h2>
        
        {* –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è *}
        {if $wa->isAuth()}
            <div class="hub-topic__comment-form">
                <form action="{$wa->getUrl('hub/frontend/comment/add')}" method="post" class="hub-comment-form">
                    <input type="hidden" name="topic_id" value="{$topic.id}">
                    <input type="hidden" name="csrf_token" value="{$wa->csrf()}">
                    
                    <div class="hub-comment-form__field">
                        <textarea name="text" class="hub-comment-form__textarea" placeholder="{_w('Write your comment...')}" required></textarea>
                    </div>
                    
                    <div class="hub-comment-form__actions">
                        <button type="submit" class="hub-comment-form__submit">{_w("Add comment")}</button>
                    </div>
                </form>
            </div>
        {/if}
        
        {* –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ *}
        <div class="hub-topic__comments-list">
            {if !empty($comments)}
                {foreach $comments as $comment}
                    {include file="./comment.html" comment=$comment inline}
                {/foreach}
            {else}
                <p class="hub-topic__comments-empty">{_w("No comments yet. Be the first to comment!")}</p>
            {/if}
        </div>
        
        {* –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ *}
        {if isset($pages_count) && $pages_count > 1}
            <div class="hub-topic__comments-pagination">
                {wa_pagination total=$pages_count attrs=['class' => "pagination"]}
            </div>
        {/if}
    </div>
</div>

{* JSON-LD —Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è —Ç–æ–ø–∏–∫–∞ *}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "DiscussionForumPosting",
    "headline": "{$topic.title|escape}",
    "author": {
        "@type": "Person",
        "name": "{$topic.author.name|default:$topic.author.login|escape}",
        "url": "{$wa->getUrl('hub/frontend/author')}/{$topic.contact_id}/"
    },
    "datePublished": "{$topic.datetime|date_format:'Y-m-d\TH:i:sP'}",
    "dateModified": "{$topic.update_datetime|date_format:'Y-m-d\TH:i:sP'}",
    "text": "{$topic.text|strip_tags|escape}",
    "url": "{$wa->getUrl('hub/frontend/topic')}/{$topic.url}/",
    "commentCount": {$comments|count},
    "interactionStatistic": {
        "@type": "InteractionCounter",
        "interactionType": "https://schema.org/LikeAction",
        "userInteractionCount": {$topic.likes_count|default:0}
    }
}
</script>
{/strip} 